<div class="min-h-screen bg-cost-offwhite flex flex-col font-sans">
  <!-- Navigation -->
  <nav class="bg-cost-white border-b border-cost-light/50 py-3 px-4 sm:px-6 lg:px-8 sticky top-0 z-50 backdrop-blur-sm"
    role="navigation" aria-label="Main navigation">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div
        class="flex items-center gap-3 text-cost-blue font-bold text-lg sm:text-xl tracking-tight animate-slide-in-left">
        <div class="w-10 h-10 sm:w-9 sm:h-9 bg-cost-red rounded-2xl flex items-center justify-center text-white"
          aria-hidden="true">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
          </svg>
        </div>
        <span class="hidden sm:inline">{{ t().nav.brandName }}</span>
        <span class="sm:hidden">{{ t().nav.brandNameShort }}</span>
      </div>
      <div class="flex items-center gap-3 md:gap-6">
        <!-- Language Selector -->
        <div class="relative">
          <button (click)="isLangMenuOpen.set(!isLangMenuOpen())" [class.text-cost-blue]="isLangMenuOpen()"
            [class.bg-cost-light/20]="isLangMenuOpen()" [class.text-cost-medium]="!isLangMenuOpen()"
            class="flex items-center gap-2 text-sm font-medium transition-all duration-300 ease-out px-4 py-2.5 rounded-full hover:text-cost-blue hover:bg-cost-light/20 min-h-[44px] min-w-[44px] justify-center"
            aria-label="Select language" aria-haspopup="true" [attr.aria-expanded]="isLangMenuOpen()">
            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10" />
              <line x1="2" y1="12" x2="22" y2="12" />
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
            </svg>
            {{ language().toUpperCase() }}
            <svg class="w-3 h-3 transition-transform duration-200" [class.rotate-180]="isLangMenuOpen()"
              xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9" />
            </svg>
          </button>

          @if (isLangMenuOpen()) {
          <!-- Backdrop -->
          <div class="fixed inset-0 z-10" (click)="isLangMenuOpen.set(false)"></div>

          <!-- Dropdown Menu -->
          <div
            class="absolute right-0 mt-2 w-40 bg-cost-white rounded-2xl shadow-xl border border-cost-light/50 py-1 z-20">
            <button (click)="handleLanguageChange('en')" [class.text-cost-blue]="language() === 'en'"
              [class.font-semibold]="language() === 'en'"
              class="block w-full text-left px-4 py-3 text-sm hover:bg-cost-light/20 text-cost-dark transition-colors duration-300 ease-out min-h-[44px]"
              role="menuitem">English</button>
            <button (click)="handleLanguageChange('es')" [class.text-cost-blue]="language() === 'es'"
              [class.font-semibold]="language() === 'es'"
              class="block w-full text-left px-4 py-3 text-sm hover:bg-cost-light/20 text-cost-dark transition-colors duration-300 ease-out min-h-[44px]"
              role="menuitem">Español (AI)</button>
            <button (click)="handleLanguageChange('pt')" [class.text-cost-blue]="language() === 'pt'"
              [class.font-semibold]="language() === 'pt'"
              class="block w-full text-left px-4 py-3 text-sm hover:bg-cost-light/20 text-cost-dark transition-colors duration-300 ease-out min-h-[44px]"
              role="menuitem">Português (AI)</button>
          </div>
          }
        </div>

        <div class="h-5 w-px bg-slate-200 mx-2 hidden md:block"></div>

        <a href="#"
          class="text-sm font-medium text-cost-medium hover:text-cost-blue transition-colors duration-300 ease-out hidden md:block px-3 py-2 min-h-[44px] flex items-center"
          aria-label="About Us">{{ t().nav.aboutUs }}</a>

        <a routerLink="/admin/login"
          class="flex items-center gap-2 text-sm font-medium text-cost-medium hover:text-cost-blue transition-colors duration-300 ease-out px-3 py-2 min-h-[44px]"
          aria-label="Admin Login">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <span class="hidden sm:inline">{{ t().nav.adminLogin }}</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Hero Section - Inspired by C40 Knowledge Hub -->
  <header
    class="relative bg-cost-blue text-white py-16 xs:py-20 sm:py-24 lg:py-28 px-4 sm:px-6 lg:px-8 overflow-hidden">
    <!-- Background with strong overlay for legibility -->
    <div class="absolute inset-0 z-0">
      <img src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?auto=format&fit=crop&q=80&w=2070" alt=""
        class="w-full h-full object-cover" loading="eager" aria-hidden="true" />
      <!-- Strong gradient overlay for text legibility -->
      <div class="absolute inset-0 bg-cost-blue/95"></div>
      <!-- Subtle pattern overlay -->
      <div class="absolute inset-0 opacity-10"
        style="background-image: url('data:image/svg+xml,%3Csvg width=&quot;60&quot; height=&quot;60&quot; viewBox=&quot;0 0 60 60&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cg fill=&quot;none&quot; fill-rule=&quot;evenodd&quot;%3E%3Cg fill=&quot;%23ffffff&quot; fill-opacity=&quot;0.4&quot;%3E%3Cpath d=&quot;M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z&quot;/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');">
      </div>
    </div>

    <div class="relative z-10 max-w-4xl mx-auto text-center">
      <h1
        class="text-3xl xs:text-4xl md:text-5xl lg:text-6xl font-semibold tracking-tight mb-5 xs:mb-6 text-white drop-shadow-sm animate-slide-up-fade">
        {{ t().hero.title }}
      </h1>
      <p class="text-base xs:text-lg md:text-xl text-slate-100 mb-8 xs:mb-10 sm:mb-12 max-w-2xl mx-auto leading-relaxed animate-slide-up-fade"
        style="animation-delay: 100ms;">
        {{ t().hero.subtitle }}
      </p>

      <!-- Search Container -->
      <div class="max-w-2xl mx-auto">
        <!-- Search Type Toggle - Improved visibility -->
        <div class="flex justify-center mb-5 gap-2 animate-slide-up-fade" style="animation-delay: 200ms;">
          <div class="inline-flex bg-white/10 backdrop-blur-sm rounded-full p-1 border border-white/20">
            <button (click)="toggleSemanticMode(false)"
              [class]="!isSemanticMode() ? 'bg-white text-cost-blue shadow-lg' : 'text-white/90 hover:text-white hover:bg-white/10'"
              class="text-sm font-semibold px-5 py-2.5 rounded-full transition-all duration-300 ease-out min-h-[42px]"
              aria-label="Switch to keyword search" [attr.aria-pressed]="!isSemanticMode()">
              {{ t().hero.keywordSearch }}
            </button>
            <button (click)="toggleSemanticMode(true)"
              [class]="isSemanticMode() ? 'bg-cost-red text-white shadow-lg animate-pulse-glow' : 'text-white/90 hover:text-white hover:bg-white/10'"
              class="flex items-center gap-2 text-sm font-semibold px-5 py-2.5 rounded-full transition-all duration-300 ease-out min-h-[42px]"
              aria-label="Switch to smart AI search" [attr.aria-pressed]="isSemanticMode()">
              <svg class="w-3.5 h-3.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path
                  d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z" />
                <path d="M5 3v4" />
                <path d="M19 17v4" />
                <path d="M3 5h4" />
                <path d="M17 19h4" />
              </svg>
              {{ t().hero.smartSearch }}
            </button>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="relative group transition-all duration-300 ease-out">
          <div class="absolute inset-y-0 left-0 pl-5 flex items-center pointer-events-none z-10">
            @if (isSemanticMode()) {
            <svg class="h-5 w-5 text-cost-red" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <path
                d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z" />
            </svg>
            } @else {
            <svg class="h-5 w-5 text-cost-medium" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            }
          </div>

          <input type="text" [(ngModel)]="searchQuery" (keydown)="onSearchKeyDown($event)"
            [placeholder]="isSemanticMode() ? t().hero.smartSearchPlaceholder : t().hero.searchPlaceholder"
            class="block w-full pl-12 pr-14 py-4 bg-white text-cost-dark rounded-full shadow-2xl focus:outline-none focus:ring-4 focus:ring-white/30 text-base placeholder:text-cost-medium/50 transition-all duration-300 ease-out border-0 min-h-[56px]"
            aria-label="Search resources" [attr.aria-describedby]="isSemanticMode() ? 'semantic-search-hint' : null" />

          <div class="absolute inset-y-2 right-2 flex items-center gap-2">
            @if (searchQuery()) {
            @if (isSemanticMode()) {
            <button (click)="searchQuery.set(''); semanticGroups.set(null);"
              class="h-full px-3 text-cost-medium hover:text-cost-blue transition-colors duration-300 ease-out min-w-[44px] min-h-[44px] flex items-center justify-center"
              aria-label="Clear search">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
            <button (click)="handleSemanticSearch()" [disabled]="aiState().isSearching"
              class="h-full px-5 xs:px-6 rounded-full bg-cost-blue hover:bg-cost-blue-600 text-white font-semibold text-sm transition-all duration-300 ease-out flex items-center gap-2 disabled:opacity-70 min-h-[44px]"
              aria-label="Ask AI to search">
              @if (aiState().isSearching) {
              <svg class="w-4 h-4 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
              </svg>
              }
              {{ t().hero.askAI }}
            </button>
            } @else {
            <button (click)="searchQuery.set('')"
              class="h-full px-4 text-cost-medium hover:text-cost-blue transition-colors duration-300 ease-out min-w-[44px] min-h-[44px] flex items-center justify-center"
              aria-label="Clear search">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
            }
            }
          </div>
        </div>

        @if (isSemanticMode()) {
        <p id="semantic-search-hint" class="text-xs text-blue-200 mt-3 font-medium opacity-90">
          {{ t().hero.smartSearchHint }}
        </p>
        }
      </div>
    </div>
  </header>



  <!-- Main Layout with Sidebar -->
  <div id="filters-section" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 xs:py-12 sm:py-16">
    <div class="flex flex-col lg:flex-row gap-8 lg:gap-12">
      <!-- Sidebar Filters -->
      <aside class="w-full lg:w-64 flex-shrink-0 space-y-8 reveal-on-scroll">
        <div class="lg:sticky lg:top-24 space-y-8">
          <!-- Filter Header -->
          <div class="flex items-center justify-between lg:hidden">
            <h2 class="text-lg font-bold text-cost-dark">{{ t().filters.filtersTitle }}</h2>
            <button (click)="resetFilters()" class="text-sm text-cost-red font-medium hover:underline">{{
              t().filters.reset }}</button>
          </div>

          <!-- Desktop Reset (Hidden on Mobile) -->
          <div class="hidden lg:flex items-center justify-between">
            <h3 class="font-bold text-cost-dark text-lg">{{ t().filters.filtersTitle }}</h3>
            @if (activeFilters().length > 0) {
            <button (click)="resetFilters()" class="text-xs text-cost-red font-medium hover:underline">
              {{ t().filters.resetAll }}
            </button>
            }
          </div>

          <!-- Topic Filter -->
          <div class="space-y-3">
            <label class="block text-sm font-semibold text-cost-dark uppercase tracking-wider">{{ t().filters.topic
              }}</label>
            <div class="space-y-2">
              <button (click)="selectedTopic.set('All')"
                [class]="selectedTopic() === 'All' ? 'bg-cost-blue text-white shadow-md' : 'text-cost-medium hover:bg-cost-light/30 hover:text-cost-blue'"
                class="w-full text-left px-4 py-2.5 rounded-xl text-sm font-medium transition-all duration-200 flex items-center justify-between gap-3 group">
                <div class="flex items-center gap-3 min-w-0">
                  <div
                    class="w-9 h-9 rounded-full border-2 border-cost-light/80 shadow-md flex items-center justify-center bg-cost-light/60 text-xs font-semibold text-white shrink-0 ring-2 ring-white"
                    [style.background]="getTopicGradient(t().filters.allTopics)">
                    <span>{{ getTopicInitial(t().filters.allTopics) }}</span>
                  </div>
                  <span class="truncate">{{ t().filters.allTopics }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    [class]="selectedTopic() === 'All' ? 'bg-white/20 text-white' : 'bg-cost-light/50 text-cost-medium'"
                    class="text-xs font-semibold px-2 py-0.5 rounded-full">
                    {{ getTotalResourceCount() }}
                  </span>
                  @if (selectedTopic() === 'All') {
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  }
                </div>
              </button>
              @for (topic of topicsData(); track topic.slug) {
              @if (topic.resourceCount > 0) {
              <button (click)="selectedTopic.set(topic.name)"
                [class]="selectedTopic() === topic.name ? 'bg-cost-blue text-white shadow-md' : 'text-cost-medium hover:bg-cost-light/30 hover:text-cost-blue'"
                class="w-full text-left px-4 py-2.5 rounded-xl text-sm font-medium transition-all duration-200 flex items-center justify-between gap-3 group">
                <div class="flex items-center gap-3 min-w-0">
                  <div
                    class="w-9 h-9 rounded-full border-2 border-cost-light/80 shadow-md overflow-hidden bg-cost-light/60 flex items-center justify-center text-xs font-semibold text-white shrink-0 ring-2 ring-white"
                    [style.background]="topic.image ? 'transparent' : getTopicGradient(topic.name)">
                    @if (topic.image) {
                    <img [src]="topic.image" [alt]="topic.name" class="w-full h-full object-cover" />
                    } @else {
                    <span>{{ getTopicInitial(topic.name) }}</span>
                    }
                  </div>
                  <span class="truncate">{{ topic.name }}</span>
                </div>
                <div class="flex items-center gap-2">
                  <span
                    [class]="selectedTopic() === topic.name ? 'bg-white/20 text-white' : 'bg-cost-light/50 text-cost-medium'"
                    class="text-xs font-semibold px-2 py-0.5 rounded-full">
                    {{ topic.resourceCount }}
                  </span>
                  @if (selectedTopic() === topic.name) {
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="20 6 9 17 4 12" />
                  </svg>
                  }
                </div>
              </button>
              }
              }
            </div>
          </div>

          <!-- Popular Resources -->
          @if (topPopularResources().length > 0) {
          <div class="space-y-3">
            <label class="block text-sm font-semibold text-cost-dark uppercase tracking-wider flex items-center gap-2">
              <svg class="w-4 h-4 text-cost-red" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path
                  d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />
              </svg>
              Trending
            </label>
            <div class="space-y-2">
              @for (resource of topPopularResources(); track resource.id; let i = $index) {
              <a [routerLink]="['/resource', resource.id]" (click)="handleResourceInteract(resource.id)"
                class="block p-4 bg-white rounded-xl border border-cost-light/30 hover:border-cost-blue/50 hover:shadow-md transition-all duration-200 group hover:-translate-y-0.5">
                <div class="flex items-start gap-3">
                  <span
                    class="flex-shrink-0 w-6 h-6 rounded-full bg-cost-red/10 text-cost-red text-xs font-bold flex items-center justify-center mt-0.5">
                    {{ i + 1 }}
                  </span>
                  <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-bold text-cost-dark group-hover:text-cost-blue transition-colors mb-1">
                      {{ resource.title }}
                    </h4>
                    <p class="text-xs text-cost-medium truncate">{{ resource.category }}</p>
                  </div>
                </div>
              </a>
              }
            </div>
          </div>
          }

        </div>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 min-w-0 relative lg:min-h-[400px]" role="main">
        <!-- Topic Cover Banner (LinkedIn-style) -->
        @if (getSelectedTopicData(); as topicData) {
        <div class="relative mb-8 rounded-2xl overflow-hidden shadow-lg animate-fade-in reveal-on-scroll">
          <!-- Cover Image -->
          <div class="h-32 sm:h-40 lg:h-48 relative">
            @if (topicData.image) {
            <img [src]="topicData.image" [alt]="topicData.name" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
            } @else {
            <div class="w-full h-full" [style.background]="getTopicGradient(topicData.name)"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
            }
          </div>

          <!-- Topic Info Overlay -->
          <div class="absolute bottom-0 left-0 right-0 p-4 sm:p-6">
            <div class="flex items-end gap-4">
              <!-- Topic Avatar -->
              <div
                class="w-16 h-16 sm:w-20 sm:h-20 rounded-xl border-4 border-white shadow-lg overflow-hidden bg-white flex-shrink-0">
                @if (topicData.image) {
                <img [src]="topicData.image" [alt]="topicData.name" class="w-full h-full object-cover" />
                } @else {
                <div class="w-full h-full flex items-center justify-center text-2xl font-bold text-white"
                  [style.background]="getTopicGradient(topicData.name)">
                  {{ getTopicInitial(topicData.name) }}
                </div>
                }
              </div>

              <!-- Topic Details -->
              <div class="flex-1 min-w-0 pb-1">
                <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-white drop-shadow-lg truncate">
                  {{ topicData.name }}
                </h2>
                <p class="text-white/90 text-sm sm:text-base mt-1 flex items-center gap-2">
                  <span class="inline-flex items-center gap-1">
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                      <polyline points="14 2 14 8 20 8" />
                    </svg>
                    {{ topicData.resourceCount }} resources
                  </span>
                </p>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- Results Header & Active Filters -->
        <div class="mb-8 space-y-4">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
            <h2 class="text-2xl font-bold text-cost-dark">{{ t().filters.resources }}</h2>

            <!-- Sort Control -->
            <div class="flex items-center gap-3">
              <span class="text-xs font-semibold text-slate-400 uppercase tracking-wider hidden sm:inline">{{
                t().filters.sortBy }}</span>
              <div class="relative min-w-[160px]">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  @if (sortOrder() === 'popular') {
                  <svg class="h-4 w-4 text-cost-red" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path
                      d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />
                  </svg>
                  } @else if (sortOrder() === 'az') {
                  <svg class="h-4 w-4 text-cost-blue" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="m3 16 4 4 4-4" />
                    <path d="M7 4v16" />
                    <path d="M20 8h-5" />
                    <path d="M15 10V6.5a2.5 2.5 0 0 1 5 0V10" />
                    <path d="M15 14h5l-5 6h5" />
                  </svg>
                  } @else {
                  <svg class="h-4 w-4 text-cost-blue" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                  </svg>
                  }
                </div>
                <select [ngModel]="sortOrder()" (ngModelChange)="sortOrder.set($event)"
                  class="appearance-none w-full pl-10 pr-8 py-2.5 bg-white border border-cost-light/50 text-cost-dark text-sm rounded-xl focus:ring-4 focus:ring-cost-blue/20 focus:border-cost-blue block cursor-pointer hover:border-cost-blue transition-all duration-300 ease-out font-medium"
                  aria-label="Sort resources">
                  <option value="newest">{{ t().filters.mostRecent }}</option>
                  <option value="popular">{{ t().filters.mostPopular }}</option>
                  <option value="oldest">{{ t().filters.oldestFirst }}</option>
                  <option value="az">{{ t().filters.azTitle }}</option>
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                  <svg class="h-4 w-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9" />
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Active Filters Chips -->
          @if (activeFilters().length > 0) {
          <div class="flex flex-wrap items-center gap-2">
            @for (filter of activeFilters(); track filter.type + filter.value) {
            <button (click)="clearFilter(filter.type)"
              class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-cost-blue/10 text-cost-blue rounded-full text-sm font-medium hover:bg-cost-blue/20 transition-colors group animate-fade-in">
              <span class="capitalize">{{ getFilterLabel(filter.type) }}:</span>
              <span class="font-semibold">{{ filter.value }}</span>
              <svg class="w-3.5 h-3.5 text-cost-blue/60 group-hover:text-cost-red transition-colors"
                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
              </svg>
            </button>
            }
          </div>
          }
        </div>

        <!-- Featured: Independent Review & Assurance Section -->
        @if (activeFilters().length === 0) {
        <section
          class="bg-gradient-to-b from-cost-blue/5 to-cost-offwhite rounded-3xl p-6 xs:p-8 mb-10 reveal-on-scroll"
          aria-labelledby="featured-heading">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 id="featured-heading" class="text-2xl sm:text-3xl font-bold text-cost-blue flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7 text-cost-red" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
                  <path
                    d="M12 2a9.96 9.96 0 0 1 6.29 2.226a1 1 0 0 1 .04 1.52l-1.51 1.362a1 1 0 0 1 -1.265 .06a6 6 0 1 0 2.103 6.836l.001 -.004h-3.66a1 1 0 0 1 -.992 -.883l-.008 -.117v-2a1 1 0 0 1 1 -1h6.1a1 1 0 0 1 .995 .9a9.96 9.96 0 0 1 -8.103 11.097a10 10 0 0 1 -11.1 -9.097a9.96 9.96 0 0 1 10.1 -9.9z" />
                </svg>
                {{ t().featured.title }}
              </h2>
              <p class="text-cost-medium mt-2 text-sm sm:text-base">{{ t().featured.subtitle }}</p>
            </div>
            <button (click)="selectedTopic.set(ResourceCategory.ASSURANCE)"
              class="hidden sm:flex items-center gap-2 text-cost-blue hover:text-cost-red font-medium text-sm transition-colors duration-300">
              {{ t().featured.viewAll }}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M5 12h14M12 5l7 7-7 7" />
              </svg>
            </button>
          </div>

          <!-- Featured Cards Grid - Skeleton Loader -->
          @if (isFeaturedLoading()) {
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            @for (i of [1,2,3,4,5,6]; track i) {
            <div class="bg-white rounded-2xl shadow-sm border border-cost-light/30 overflow-hidden">
              <div class="p-5">
                <div class="flex items-start justify-between mb-3">
                  <div
                    class="h-6 w-20 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                  </div>
                  <div
                    class="h-4 w-4 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%]">
                  </div>
                </div>
                <div
                  class="h-5 w-full bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-2">
                </div>
                <div
                  class="h-5 w-3/4 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-3">
                </div>
                <div
                  class="h-4 w-full bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-1">
                </div>
                <div
                  class="h-4 w-5/6 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-4">
                </div>
                <div class="flex items-center justify-between pt-3 border-t border-cost-light/30">
                  <div class="flex gap-1.5">
                    <div
                      class="h-5 w-14 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                    </div>
                    <div
                      class="h-5 w-16 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                    </div>
                  </div>
                  <div
                    class="h-5 w-16 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%]">
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
          } @else if (featuredResources().length > 0) {
          <!-- Featured Cards Grid - Actual Content -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
            @for (resource of featuredResources().slice(0, 6); track resource.id) {
            <a [routerLink]="['/resource', resource.id]" (click)="handleResourceInteract(resource.id)"
              class="bg-white rounded-2xl shadow-sm border border-cost-light/30 hover:border-cost-blue/30 hover:shadow-xl transition-all duration-300 overflow-hidden group animate-fade-in cursor-pointer block hover:-translate-y-1 flex flex-col h-full">
              <div class="p-6 flex flex-col h-full">
                <div class="flex items-start justify-between mb-4">
                  <span
                    class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-cost-offwhite text-cost-medium group-hover:bg-cost-blue/10 group-hover:text-cost-blue transition-colors">
                    {{ resource.type }}
                  </span>
                  @if (resource.featured) {
                  <span class="inline-flex items-center gap-1 text-amber-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                      <path
                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                  </span>
                  }
                </div>
                <h3
                  class="font-bold text-lg text-cost-dark group-hover:text-cost-blue transition-colors duration-300 mb-3">
                  {{ resource.title }}
                </h3>
                <div class="flex-1"></div>
                <div class="flex items-center justify-between pt-4 border-t border-cost-light/20 mt-auto">
                  <div class="flex flex-wrap gap-1.5">
                    @for (tag of (resource.tags || []).slice(0, 2); track tag) {
                    <span class="text-xs px-2 py-0.5 bg-cost-light/30 text-cost-medium rounded-full">{{ tag }}</span>
                    }
                  </div>
                  <span
                    class="flex items-center gap-1 text-cost-blue group-hover:text-cost-red font-semibold text-sm transition-colors duration-300 group-hover:translate-x-1 transition-transform">
                    {{ t().featured.access }}
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2">
                      <path d="M9 18l6-6-6-6" />
                    </svg>
                  </span>
                </div>
              </div>
            </a>
            }
          </div>

          <!-- Mobile: View All -->
          <div class="mt-6 sm:hidden">
            <button (click)="selectedTopic.set(ResourceCategory.ASSURANCE)"
              class="w-full py-3 text-center text-cost-blue hover:text-cost-red font-medium text-sm transition-colors duration-300 border border-cost-blue/30 rounded-xl hover:border-cost-red/30">
              {{ t().featured.viewAll }} →
            </button>
          </div>
          }
        </section>
        }

        <!-- Global Loading Overlay for Translation -->
        @if (aiState().isTranslating) {
        <div class="absolute inset-0 bg-white/80 z-20 flex items-center justify-center backdrop-blur-sm rounded-xl">
          <div class="text-center">
            <svg class="w-10 h-10 text-cost-blue animate-spin mx-auto mb-4" xmlns="http://www.w3.org/2000/svg"
              fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
              </path>
            </svg>
            <p class="text-cost-blue font-bold text-lg">{{ t().loading.translating }}</p>
            <p class="text-slate-500 text-sm">{{ t().loading.poweredBy }}</p>
          </div>
        </div>
        }

        <!-- Skeleton Loader for Main Content -->
        @if (isLoading()) {
        <div class="space-y-12">
          <!-- Skeleton Section Header -->
          <div>
            <div class="flex items-start gap-4 mb-8 border-b border-cost-light/50 pb-6">
              <div
                class="mt-1 p-3 rounded-2xl bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 animate-shimmer bg-[length:200%_100%] w-12 h-12">
              </div>
              <div class="flex-1">
                <div
                  class="h-8 w-48 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-2">
                </div>
                <div
                  class="h-4 w-96 max-w-full bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%]">
                </div>
              </div>
            </div>
            <!-- Skeleton Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              @for (i of [1,2,3,4,5,6]; track i) {
              <div class="bg-white rounded-2xl shadow-sm border border-cost-light/30 overflow-hidden p-5">
                <div class="flex items-start justify-between mb-4">
                  <div
                    class="h-6 w-24 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                  </div>
                  <div
                    class="h-5 w-5 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%]">
                  </div>
                </div>
                <div
                  class="h-6 w-full bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-2">
                </div>
                <div
                  class="h-6 w-2/3 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-4">
                </div>
                <div
                  class="h-4 w-full bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-2">
                </div>
                <div
                  class="h-4 w-5/6 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%] mb-4">
                </div>
                <div class="flex items-center justify-between pt-4 border-t border-cost-light/30">
                  <div class="flex gap-2">
                    <div
                      class="h-5 w-16 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                    </div>
                    <div
                      class="h-5 w-14 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded-full animate-shimmer bg-[length:200%_100%]">
                    </div>
                  </div>
                  <div
                    class="h-5 w-20 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded animate-shimmer bg-[length:200%_100%]">
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
        </div>
        } @else if (viewGroups().length > 0) {
        <!-- Content Render Loop: Sections/Groups -->
        <div class="space-y-12 xs:space-y-16 sm:space-y-20">
          @for (group of viewGroups(); track group.title; let i = $index) {
          <section class="animate-fade-in reveal-on-scroll" [attr.aria-labelledby]="'section-title-' + i">
            <!-- Section Header -->
            <div class="flex items-start gap-4 mb-8 border-b border-cost-light/50 pb-6">
              <div [class]="isSemanticMode() ? 'bg-cost-blue/10 text-cost-blue' : 'bg-cost-light/20 text-cost-medium'"
                class="mt-1 p-3 rounded-2xl">
                @if (isSemanticMode()) {
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2">
                  <path
                    d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" />
                  <path d="M9 18h6" />
                  <path d="M10 22h4" />
                </svg>
                } @else {
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2">
                  <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
                </svg>
                }
              </div>
              <div>
                <h2 [id]="'section-title-' + i"
                  class="text-2xl xs:text-3xl font-semibold text-cost-dark tracking-tight">{{ group.title }}</h2>
                <p class="text-cost-medium mt-2 max-w-3xl text-sm xs:text-base">{{ group.description }}</p>
              </div>
            </div>

            <!-- Resources Grid for this Section -->
            @if (group.resources.length > 0) {
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              @for (resource of group.resources; track resource.id) {
              <app-resource-card [resource]="resource" [isPopular]="popularIds().has(resource.id)"
                (interact)="handleResourceInteract($event)" (filterByCategory)="handleFilterByCategory($event)"
                (filterByTag)="handleFilterByTag($event)" />
              }
            </div>
            } @else {
            <!-- Empty state for category with no resources -->
            <div class="text-center py-16 bg-white rounded-2xl border border-dashed border-cost-light/50">
              <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-cost-offwhite mb-4">
                <svg class="w-7 h-7 text-cost-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                  <polyline points="14 2 14 8 20 8" />
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-cost-blue mb-2">{{ t().results.noResourcesInCategory }}</h3>
              <p class="text-cost-medium text-sm max-w-md mx-auto">
                {{ t().results.noResourcesInCategoryDesc }}
              </p>
            </div>
            }
          </section>
          }
        </div>
        } @else if (searchQuery() || selectedTopic() !== 'All' || selectedTag()) {
        <!-- No results only when actively filtering/searching -->
        <div class="text-center py-24 bg-white rounded-3xl border border-dashed border-cost-light/50">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-cost-offwhite mb-6">
            @if (isSemanticMode()) {
            <svg class="w-8 h-8 text-cost-blue" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <path
                d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z" />
            </svg>
            } @else {
            <svg class="w-8 h-8 text-cost-light" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            }
          </div>
          <h3 class="text-xl font-semibold text-cost-blue mb-2">{{ t().results.noResults }}</h3>
          <p class="text-cost-medium max-w-md mx-auto mb-8">
            @if (isSemanticMode()) {
            {{ t().results.noResultsAI }}
            } @else {
            {{ t().results.noResultsKeyword }}
            }
          </p>
          <button (click)="resetFilters()"
            class="inline-flex items-center px-6 py-3 border border-transparent text-sm font-semibold rounded-full text-white bg-cost-blue hover:bg-cost-blue-600 focus:outline-none focus:ring-4 focus:ring-cost-blue/20 transition-all duration-300 ease-out min-h-[44px]"
            aria-label="Reset all filters">
            {{ t().results.resetFilters }}
          </button>
        </div>
        }
      </main>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-cost-blue py-10 xs:py-12 sm:py-16 mt-8 xs:mt-10 sm:mt-12" role="contentinfo">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-12 border-b border-white/20 pb-12 mb-12">
        <div class="md:col-span-2">
          <div class="flex items-center gap-3 text-white font-bold text-2xl tracking-tight mb-6">
            <div class="w-10 h-10 bg-cost-red rounded-lg flex items-center justify-center text-white shadow-lg">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
              </svg>
            </div>
            {{ t().nav.brandName }}
          </div>
          <p class="text-white/80 leading-relaxed max-w-md">
            {{ t().footer.description }}
          </p>
        </div>

        <div>
          <h4 class="text-white font-semibold mb-6 uppercase text-sm tracking-wider">{{ t().footer.keyResources }}</h4>
          <ul class="space-y-3 text-sm">
            <li><a href="#" class="text-white/80 hover:text-cost-yellow transition-colors block">OC4IDS
                Documentation</a></li>
            <li><a href="#" class="text-white/80 hover:text-cost-yellow transition-colors block">Assurance Manual</a>
            </li>
            <li><a href="#" class="text-white/80 hover:text-cost-yellow transition-colors block">Transparency Index</a>
            </li>
            <li><a href="#" class="text-white/80 hover:text-cost-yellow transition-colors block">Guidance Notes</a></li>
          </ul>
        </div>

        <div>
          <h4 class="text-white font-semibold mb-6 uppercase text-sm tracking-wider">{{ t().footer.connect }}</h4>
          <ul class="space-y-3 text-sm">
            <li><a href="https://twitter.com/CoaborativeCoST" target="_blank"
                class="text-white/80 hover:text-cost-yellow transition-colors block">Twitter / X</a></li>
            <li><a href="https://www.linkedin.com/company/cost-infrastructure-transparency-initiative/" target="_blank"
                class="text-white/80 hover:text-cost-yellow transition-colors block">LinkedIn</a></li>
            <li><a href="https://infrastructuretransparency.org/contact/" target="_blank"
                class="text-white/80 hover:text-cost-yellow transition-colors block">Contact Support</a></li>
            <li><a href="https://cost-admin-dashboard-199832110436.us-central1.run.app/login" target="_blank"
                class="text-white/80 hover:text-cost-yellow transition-colors block flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                  <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
                {{ t().footer.adminDashboard }}
              </a></li>
          </ul>
        </div>
      </div>

      <div class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm font-medium">
        <p class="text-white/70">{{ t().footer.copyright }}</p>
        <div class="flex items-center gap-8">
          <a href="#" class="text-white/70 hover:text-white transition-colors">{{ t().footer.privacyPolicy }}</a>
          <a href="#" class="text-white/70 hover:text-white transition-colors">{{ t().footer.termsOfService }}</a>
          <a href="#" class="text-white/70 hover:text-white transition-colors">{{ t().footer.cookiePolicy }}</a>
        </div>
      </div>
    </div>
  </footer>
</div>