<div class="min-h-screen bg-cost-offwhite">
  <!-- Navigation Bar -->
  <nav class="bg-cost-white border-b border-cost-light/50 py-3 px-4 sm:px-6 lg:px-8 sticky top-0 z-50 backdrop-blur-sm">
    <div class="max-w-5xl mx-auto flex items-center justify-between">
      <button (click)="goBack()" class="flex items-center gap-2 text-cost-blue hover:text-cost-red transition-colors font-medium">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        {{ t().detail.backToHub }}
      </button>
      <a routerLink="/" class="flex items-center gap-2 text-cost-blue font-bold">
        <div class="w-8 h-8 bg-cost-red rounded-xl flex items-center justify-center text-white">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
          </svg>
        </div>
        <span class="hidden sm:inline">{{ t().nav.brandNameShort }}</span>
      </a>
    </div>
  </nav>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="animate-pulse">
      <div class="h-8 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded w-3/4 mb-4 bg-[length:200%_100%] animate-shimmer"></div>
      <div class="h-6 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded w-1/2 mb-8 bg-[length:200%_100%] animate-shimmer"></div>
      <div class="space-y-3">
        <div class="h-4 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded bg-[length:200%_100%] animate-shimmer"></div>
        <div class="h-4 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded w-5/6 bg-[length:200%_100%] animate-shimmer"></div>
        <div class="h-4 bg-gradient-to-r from-slate-200 via-slate-100 to-slate-200 rounded w-4/5 bg-[length:200%_100%] animate-shimmer"></div>
      </div>
    </div>
  </div>
  } @else if (resource()) {
  <!-- Main Content -->
  <main class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
    <!-- Cover Image -->
    @if (hasValidCoverImage()) {
    <div class="relative rounded-2xl overflow-hidden mb-8 h-64 sm:h-80">
      <img [src]="resource()!.coverImage!" [alt]="resource()!.title" class="w-full h-full object-cover" (error)="onImageError($event)" />
      <div class="absolute inset-0 bg-gradient-to-t from-cost-blue/60 via-transparent to-transparent"></div>
    </div>
    }

    <!-- Resource Header -->
    <div class="mb-8">
      <!-- Badges -->
      <div class="flex flex-wrap gap-2 mb-4">
        <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium bg-cost-light/30 text-cost-dark uppercase tracking-wider">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
          </svg>
          {{ resource()!.type }}
        </span>
        <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-semibold bg-cost-blue/10 text-cost-blue">
          <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
            <line x1="7" y1="7" x2="7.01" y2="7"></line>
          </svg>
          {{ resource()!.category }}
        </span>
      </div>

      <!-- Title -->
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-cost-dark leading-tight mb-4">
        {{ resource()!.title }}
      </h1>

      <!-- Date -->
      <p class="text-cost-medium flex items-center gap-2 mb-6">
        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        {{ getFormattedDate(resource()!.date) }}
      </p>
    </div>

    <!-- Description -->
    <div class="bg-white rounded-2xl p-6 sm:p-8 shadow-sm border border-cost-light/30 mb-8">
      <h2 class="text-xl font-semibold text-cost-dark mb-4 flex items-center gap-2">
        <svg class="w-5 h-5 text-cost-blue" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        {{ t().detail.aboutResource }}
      </h2>
      <p class="text-cost-dark text-lg leading-relaxed">
        {{ resource()!.description }}
      </p>
    </div>

    <!-- Tags -->
    @if (resource()?.tags && resource()!.tags!.length > 0) {
    <div class="mb-8">
      <h3 class="text-sm font-semibold text-cost-medium uppercase tracking-wider mb-3">{{ t().detail.topicsCovered }}</h3>
      <div class="flex flex-wrap gap-2">
        @for (tag of resource()!.tags!; track tag) {
        <span class="px-4 py-2 bg-white border border-cost-light/50 text-cost-dark rounded-full text-sm font-medium">
          {{ tag }}
        </span>
        }
      </div>
    </div>
    }

    <!-- Access Button -->
    <div class="bg-cost-blue rounded-2xl p-6 sm:p-8 text-center mb-12">
      <h3 class="text-white text-xl font-semibold mb-2">{{ t().detail.readyToAccess }}</h3>
      <p class="text-white/80 mb-6">{{ t().detail.redirectNotice }}</p>
      <a [href]="resource()!.url" target="_blank" rel="noopener noreferrer"
         (click)="trackInteraction(resource()!.id)"
         class="inline-flex items-center gap-3 bg-white text-cost-blue px-8 py-4 rounded-full text-lg font-bold hover:bg-cost-yellow hover:text-cost-dark transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105">
        {{ t().detail.accessResource }}
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
          <polyline points="15 3 21 3 21 9"></polyline>
          <line x1="10" y1="14" x2="21" y2="3"></line>
        </svg>
      </a>
    </div>

    <!-- Related Resources -->
    @if (relatedResources().length > 0 || isRelatedLoading()) {
    <section class="mt-12">
      <h2 class="text-2xl font-bold text-cost-dark mb-6 flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-cost-blue" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" />
        </svg>
        {{ t().detail.relatedResources }}
      </h2>

      @if (isRelatedLoading()) {
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        @for (i of [1,2,3,4]; track i) {
        <div class="bg-white rounded-xl p-5 border border-cost-light/30 animate-pulse">
          <div class="h-5 bg-slate-200 rounded w-3/4 mb-2"></div>
          <div class="h-4 bg-slate-200 rounded w-full mb-1"></div>
          <div class="h-4 bg-slate-200 rounded w-2/3"></div>
        </div>
        }
      </div>
      } @else {
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        @for (related of relatedResources(); track related.id) {
        <a [routerLink]="['/resource', related.id]"
           class="bg-white rounded-2xl shadow-sm border border-cost-light/30 hover:shadow-lg hover:border-cost-blue/30 transition-all duration-300 overflow-hidden group block">
          <div class="p-5 flex flex-col h-full">
            <!-- Header with type badge -->
            <div class="flex items-start justify-between mb-3">
              <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-semibold bg-cost-red/10 text-cost-red">
                {{ related.type }}
              </span>
            </div>

            <!-- Title -->
            <h4 class="font-semibold text-cost-dark group-hover:text-cost-blue transition-colors duration-300 mb-3 flex-1 line-clamp-2">
              {{ related.title }}
            </h4>

            <!-- Footer with tags and access link -->
            <div class="flex items-center justify-between pt-3 border-t border-cost-light/30 mt-auto">
              <div class="flex flex-wrap gap-1.5">
                @for (tag of (related.tags || []).slice(0, 2); track tag) {
                <span class="text-xs px-2 py-0.5 bg-cost-light/30 text-cost-medium rounded-full">{{ tag }}</span>
                }
              </div>
              <span class="flex items-center gap-1 text-cost-blue group-hover:text-cost-red font-medium text-sm transition-colors duration-300 whitespace-nowrap ml-2">
                {{ t().featured.access }}
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 18l6-6-6-6"/>
                </svg>
              </span>
            </div>
          </div>
        </a>
        }
      </div>
      }
    </section>
    }
  </main>
  } @else {
  <!-- Not Found -->
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-24 text-center">
    <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-cost-light/30 mb-6">
      <svg class="w-10 h-10 text-cost-medium" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
    </div>
    <h2 class="text-2xl font-bold text-cost-dark mb-2">{{ t().detail.notFound }}</h2>
    <p class="text-cost-medium mb-8">{{ t().detail.notFoundMessage }}</p>
    <a routerLink="/" class="inline-flex items-center gap-2 bg-cost-blue text-white px-6 py-3 rounded-full font-semibold hover:bg-cost-blue-600 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      {{ t().detail.backToHub }}
    </a>
  </div>
  }
</div>
