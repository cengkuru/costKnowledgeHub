<div class="resource-form-container">
  <!-- Compact Header -->
  <div class="compact-header">
    <div class="flex items-center justify-between">
      <h1 class="text-lg font-semibold text-gray-900">
        {{ isEditMode ? 'Edit Resource' : 'Create Resource' }}
      </h1>
      
      <!-- Compact indicators -->
      <div class="flex items-center space-x-4">
        <!-- Auto-save indicator -->
        <div *ngIf="isEditMode" class="save-indicator">
          <svg *ngIf="lastSaved" class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
          </svg>
          <span class="text-xs text-gray-500">
            {{ lastSaved ? 'Saved' : 'Unsaved' }}
          </span>
        </div>
        
        <!-- Minimal progress -->
        <div class="text-xs text-gray-500">
          {{ formCompletion }}% complete
        </div>
      </div>
    </div>
    
    <!-- Minimal progress bar -->
    <div class="minimal-progress">
      <div class="progress-track">
        <div class="progress-fill" [style.width.%]="formCompletion"></div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-card">
      <div class="loading-spinner"></div>
      <p class="text-gray-600 mt-4">Loading resource details...</p>
    </div>
  </div>

  <!-- Resource Type Selection -->
  <div *ngIf="!loading && showTypeSelection" class="type-selection-container">
    <div class="type-selection-header">
      <h2 class="text-2xl font-semibold text-gray-900 mb-2">What type of resource are you creating?</h2>
      <p class="text-gray-600">Choose a resource type to get a customized workflow for your content</p>
    </div>
    
    <div class="type-grid">
      <button
        *ngFor="let type of resourceTypes"
        (click)="selectResourceType(type.value)"
        class="type-card">
        <div class="type-icon">
          <!-- Icons for each type -->
          <svg *ngIf="type.value === 'guide'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          <svg *ngIf="type.value === 'case-study'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <svg *ngIf="type.value === 'report' || type.value === 'independent-review'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          <svg *ngIf="type.value === 'dataset'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
          </svg>
          <svg *ngIf="type.value === 'tool'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <svg *ngIf="type.value === 'policy'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
          </svg>
          <svg *ngIf="type.value === 'template'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
          </svg>
          <svg *ngIf="type.value === 'infographic'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <svg *ngIf="type.value === 'other'" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
          </svg>
        </div>
        <h3 class="type-title">{{ type.label }}</h3>
        <p class="type-description" [ngSwitch]="type.value">
          <span *ngSwitchCase="'guide'">Step-by-step instructions and implementation guidance</span>
          <span *ngSwitchCase="'case-study'">Real-world examples and lessons learned</span>
          <span *ngSwitchCase="'report'">Research findings and analytical reports</span>
          <span *ngSwitchCase="'independent-review'">CoST assurance process reports</span>
          <span *ngSwitchCase="'dataset'">Data files and statistical resources</span>
          <span *ngSwitchCase="'tool'">Software, calculators, and utilities</span>
          <span *ngSwitchCase="'policy'">Policy recommendations and briefs</span>
          <span *ngSwitchCase="'template'">Reusable documents and forms</span>
          <span *ngSwitchCase="'infographic'">Visual summaries and data visualizations</span>
          <span *ngSwitchCase="'other'">Other types of resources</span>
        </p>
      </button>
    </div>
  </div>

  <!-- Form Content -->
  <div *ngIf="!loading && !showTypeSelection" class="form-content">
    <!-- Resource Type Badge -->
    <div class="type-badge-container" *ngIf="selectedResourceType">
      <span class="type-badge">
        {{ getResourceTypeLabel() }}
      </span>
      <button type="button" (click)="resetTypeSelection()" class="change-type-btn">
        Change type
      </button>
    </div>
    
    <!-- Sticky Tabs Navigation -->
    <div class="tabs-navigation sticky-navigation">
      <button
        *ngFor="let tab of tabs; let i = index"
        (click)="setActiveTab(tab.id)"
        class="tab-button"
        [class.active]="activeTab === tab.id"
        [class.complete]="tab.complete">
        <div class="tab-icon">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="tab.icon" />
          </svg>
          <svg *ngIf="tab.complete" class="checkmark" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
          </svg>
        </div>
        <span class="tab-label">{{ tab.label }}</span>
      </button>
    </div>

    <!-- Tab Content -->
    <form [formGroup]="resourceForm" class="tab-content">
      <!-- Basic Information Tab -->
      <div *ngIf="activeTab === 'basic'" class="tab-panel animate-fadeIn">
        <div class="section-header">
          <h2 class="text-base font-medium text-gray-900">Basic Information</h2>
          <p *ngIf="getTabHint('basic')" class="text-sm text-gray-600 mt-1">
            {{ getTabHint('basic') }}
          </p>
        </div>

        <!-- Title with Language Tabs -->
        <div class="form-section">
          <div class="form-section-header">
            <label class="form-label required">Resource Title</label>
            <button
              type="button"
              (click)="copyToAllLanguages('title')"
              class="btn-copy-all"
              title="Copy English title to all languages">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copy to all
            </button>
          </div>
          <div class="language-tabs">
            <button
              *ngFor="let lang of languages"
              type="button"
              (click)="setActiveLanguage(lang.value)"
              class="lang-tab"
              [class.active]="activeLanguage === lang.value">
              <span class="flag">{{ lang.flag }}</span>
              <span>{{ lang.label }}</span>
              <svg *ngIf="resourceForm.get('title.' + lang.value)?.valid && resourceForm.get('title.' + lang.value)?.touched" 
                   class="w-4 h-4 text-green-500 ml-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          
          <div class="language-content" formGroupName="title">
            <div *ngFor="let lang of languages" [hidden]="activeLanguage !== lang.value">
              <div class="input-wrapper">
                <input
                  type="text"
                  [formControlName]="lang.value"
                  class="form-input"
                  [class.valid]="isFieldValid('title.' + lang.value)"
                  [class.invalid]="resourceForm.get('title.' + lang.value)?.invalid && resourceForm.get('title.' + lang.value)?.touched"
                  placeholder="Enter a descriptive title">
                <div class="field-feedback">
                  <span *ngIf="isFieldValid('title.' + lang.value)" class="success-checkmark">✓</span>
                </div>
              </div>
              
              <!-- Enhanced character count and validation -->
              <div class="field-meta">
                <div class="character-info" 
                     [ngClass]="{
                       'text-green-600': getCharacterInfo('title.' + lang.value).status === 'good',
                       'text-yellow-600': getCharacterInfo('title.' + lang.value).status === 'warning',
                       'text-red-600': getCharacterInfo('title.' + lang.value).status === 'error'
                     }">
                  {{ getCharacterInfo('title.' + lang.value).count }} characters
                  <span *ngIf="getCharacterInfo('title.' + lang.value).status === 'good'">✓ Good length</span>
                  <span *ngIf="getCharacterInfo('title.' + lang.value).status === 'warning'">⚠ Could be better</span>
                  <span *ngIf="getCharacterInfo('title.' + lang.value).status === 'error'">✗ Needs attention</span>
                </div>
                <div class="field-hint-text">{{ getFieldHint('title.' + lang.value) }}</div>
              </div>
              
              <!-- Error message -->
              <p class="field-error" *ngIf="resourceForm.get('title.' + lang.value)?.invalid && resourceForm.get('title.' + lang.value)?.touched">
                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                {{ getFieldError('title.' + lang.value) }}
              </p>
            </div>
          </div>
        </div>

        <!-- Resource Type -->
        <div class="form-section">
          <label class="form-label required">Resource Type</label>
          <p class="field-hint">What kind of resource is this?</p>
          <div class="type-grid">
            <button
              *ngFor="let type of resourceTypes"
              type="button"
              (click)="resourceForm.patchValue({type: type.value})"
              class="type-card"
              [class.selected]="resourceForm.get('type')?.value === type.value">
              <div class="type-icon">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <span class="type-label">{{ type.label }}</span>
            </button>
          </div>
          <p class="field-error" *ngIf="resourceForm.get('type')?.invalid && resourceForm.get('type')?.touched">
            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            {{ friendlyMessages.noTypeSelected }}
          </p>
        </div>

        <!-- Topics -->
        <div class="form-section">
          <label class="form-label required">Topics</label>
          <p class="field-hint">Select all topics that apply (choose at least one)</p>
          <div class="topics-grid">
            <button
              *ngFor="let topic of topics"
              type="button"
              (click)="toggleTopic(topic.value)"
              class="topic-chip"
              [class.selected]="isTopicSelected(topic.value)">
              <svg *ngIf="isTopicSelected(topic.value)" class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
              {{ topic.label }}
            </button>
          </div>
          <p class="field-error" *ngIf="resourceForm.get('topics')?.invalid && resourceForm.get('topics')?.touched">
            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            {{ friendlyMessages.noTopicsSelected }}
          </p>
        </div>

        <!-- Featured Toggle -->
        <div class="form-section">
          <div class="toggle-wrapper">
            <label class="toggle-label">
              <input
                type="checkbox"
                formControlName="featured"
                class="toggle-input">
              <span class="toggle-switch"></span>
              <span class="toggle-text">
                <strong>Feature this resource</strong>
                <span class="text-sm text-gray-500 block">Show in the featured section on the homepage</span>
              </span>
            </label>
          </div>
        </div>

        <!-- Section Navigation -->
        <div class="section-navigation">
          <button
            *ngIf="canNavigate('previous')"
            type="button"
            (click)="navigateToTab('previous')"
            class="btn-nav-previous">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Previous: {{ tabs[getCurrentTabIndex() - 1].label }}
          </button>
          <div class="nav-spacer"></div>
          <button
            *ngIf="canNavigate('next')"
            type="button"
            (click)="navigateToTab('next')"
            class="btn-nav-next">
            Next: {{ tabs[getCurrentTabIndex() + 1].label }}
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Content Tab -->
      <div *ngIf="activeTab === 'content'" class="tab-panel animate-fadeIn">
        <div class="section-header">
          <h2 class="text-base font-medium text-gray-900">Content Details</h2>
          <p *ngIf="getTabHint('content')" class="text-sm text-gray-600 mt-1">
            {{ getTabHint('content') }}
          </p>
        </div>

        <!-- Description with Language Tabs -->
        <div class="form-section">
          <div class="form-section-header">
            <label class="form-label required">Description</label>
            <button
              type="button"
              (click)="copyToAllLanguages('description')"
              class="btn-copy-all"
              title="Copy English description to all languages">
              <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              Copy to all
            </button>
          </div>
          <div class="language-tabs">
            <button
              *ngFor="let lang of languages"
              type="button"
              (click)="setActiveLanguage(lang.value)"
              class="lang-tab"
              [class.active]="activeLanguage === lang.value">
              <span class="flag">{{ lang.flag }}</span>
              <span>{{ lang.label }}</span>
              <svg *ngIf="resourceForm.get('description.' + lang.value)?.valid && resourceForm.get('description.' + lang.value)?.touched" 
                   class="w-4 h-4 text-green-500 ml-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
          
          <div class="language-content" formGroupName="description">
            <div *ngFor="let lang of languages" [hidden]="activeLanguage !== lang.value">
              <div class="textarea-wrapper">
                <textarea
                  [formControlName]="lang.value"
                  class="form-textarea"
                  [class.valid]="isFieldValid('description.' + lang.value)"
                  [class.invalid]="resourceForm.get('description.' + lang.value)?.invalid && resourceForm.get('description.' + lang.value)?.touched"
                  rows="6"
                  placeholder="Provide a clear and comprehensive description of this resource..."></textarea>
                
                <!-- Enhanced character count with visual feedback -->
                <div class="field-meta">
                  <div class="character-info" 
                       [ngClass]="{
                         'text-green-600': getCharacterInfo('description.' + lang.value).status === 'good',
                         'text-yellow-600': getCharacterInfo('description.' + lang.value).status === 'warning',
                         'text-red-600': getCharacterInfo('description.' + lang.value).status === 'error'
                       }">
                    {{ getCharacterInfo('description.' + lang.value).count }} characters
                    <span *ngIf="getCharacterInfo('description.' + lang.value).max"> / {{ getCharacterInfo('description.' + lang.value).max }}</span>
                    <span *ngIf="getCharacterInfo('description.' + lang.value).status === 'good'">✓ Good detail</span>
                    <span *ngIf="getCharacterInfo('description.' + lang.value).status === 'warning'">⚠ Consider more detail</span>
                    <span *ngIf="getCharacterInfo('description.' + lang.value).status === 'error'">✗ Too short or too long</span>
                  </div>
                  <div class="field-hint-text">{{ getFieldHint('description.' + lang.value) }}</div>
                </div>
              </div>
              
              <!-- Error message -->
              <p class="field-error" *ngIf="resourceForm.get('description.' + lang.value)?.invalid && resourceForm.get('description.' + lang.value)?.touched">
                <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                {{ getFieldError('description.' + lang.value) }}
              </p>
            </div>
          </div>
        </div>

        <!-- Tags -->
        <div class="form-section">
          <label class="form-label">Tags</label>
          <p class="field-hint">Add keywords to help people find this resource</p>
          <div class="tags-input">
            <div class="tags-container">
              <span *ngFor="let tag of resourceForm.get('tags')?.value" class="tag">
                {{ tag }}
                <button type="button" (click)="removeTag(tag)" class="tag-remove">×</button>
              </span>
              <input
                type="text"
                class="tag-input"
                placeholder="Type and press Enter"
                (keydown.enter)="addTag($event); $event.preventDefault()">
            </div>
          </div>
        </div>

        <!-- Section Navigation -->
        <div class="section-navigation">
          <button
            *ngIf="canNavigate('previous')"
            type="button"
            (click)="navigateToTab('previous')"
            class="btn-nav-previous">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Previous: {{ tabs[getCurrentTabIndex() - 1].label }}
          </button>
          <div class="nav-spacer"></div>
          <button
            *ngIf="canNavigate('next')"
            type="button"
            (click)="navigateToTab('next')"
            class="btn-nav-next">
            Next: {{ tabs[getCurrentTabIndex() + 1].label }}
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Files & Media Tab -->
      <div *ngIf="activeTab === 'files'" class="tab-panel animate-fadeIn">
        <div class="section-header">
          <h2 class="text-base font-medium text-gray-900">Files & Media</h2>
          <p class="text-sm text-gray-600 mt-1">
            {{ getTabHint('files') || 'Attach files or link to external resources' }}
          </p>
        </div>

        <!-- Step 1: Choose Upload Method (Progressive Disclosure) -->
        <div class="form-section">
          <label class="form-label">How would you like to add your resource?</label>
          <div class="upload-method-selector">
            <button
              type="button"
              (click)="selectedUploadMethod = 'file'"
              class="upload-method-card"
              [class.selected]="selectedUploadMethod === 'file'">
              <svg class="w-8 h-8 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
              </svg>
              <h3 class="font-medium">Upload File</h3>
              <p class="text-sm">Upload a PDF, document, or image</p>
            </button>
            
            <button
              type="button"
              (click)="selectedUploadMethod = 'link'"
              class="upload-method-card"
              [class.selected]="selectedUploadMethod === 'link'">
              <svg class="w-8 h-8 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
              </svg>
              <h3 class="font-medium">External Link</h3>
              <p class="text-sm">Link to resource hosted elsewhere</p>
            </button>

            <button
              *ngIf="resourceForm.get('type')?.value === 'independent-review'"
              type="button"
              (click)="selectedUploadMethod = 'import'"
              class="upload-method-card"
              [class.selected]="selectedUploadMethod === 'import'">
              <svg class="w-8 h-8 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <h3 class="font-medium">Import from CoST</h3>
              <p class="text-sm">Auto-import from CoST website</p>
            </button>
          </div>
        </div>

        <!-- Step 2: Upload Interface (Progressive Disclosure) -->
        <div *ngIf="selectedUploadMethod" class="form-section">
          
          <!-- File Upload Method -->
          <div *ngIf="selectedUploadMethod === 'file'">
            <label class="form-label">Upload Your File</label>
            <app-file-upload
              [showTitle]="false"
              [uploadFolder]="'resources/' + (resourceId || 'new')"
              [allowMultiple]="false"
              [maxFiles]="1"
              (filesUploaded)="onPrimaryFileUploaded($event)"
              (fileRemoved)="onPrimaryFileRemoved()">
            </app-file-upload>
            
            <!-- Show uploaded file -->
            <div *ngIf="uploadedFiles.length > 0" class="mt-4 p-4 bg-gray-50 border border-gray-200 rounded-lg">
              <div class="flex items-center">
                <svg class="w-8 h-8 text-gray-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <div>
                  <p class="font-medium">{{ uploadedFiles[0].name }}</p>
                  <p class="text-sm text-gray-500">{{ formatFileSize(uploadedFiles[0].size) }}</p>
                </div>
              </div>
            </div>
          </div>

          <!-- External Link Method -->
          <div *ngIf="selectedUploadMethod === 'link'">
            <label class="form-label">External Link URL</label>
            <div class="input-wrapper">
              <input
                type="url"
                formControlName="externalLink"
                class="form-input"
                placeholder="https://example.com/resource"
                [class.valid]="isFieldValid('externalLink')"
                [class.invalid]="resourceForm.get('externalLink')?.invalid && resourceForm.get('externalLink')?.touched">
              <div class="field-feedback">
                <svg *ngIf="resourceForm.get('externalLink')?.valid && resourceForm.get('externalLink')?.value" 
                     class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
              </div>
            </div>
            <p class="field-hint">Link to a resource hosted on an external website</p>
          </div>

          <!-- Import from CoST Method -->
          <div *ngIf="selectedUploadMethod === 'import'" formGroupName="independentReviewData">
            <label class="form-label">CoST Website URL</label>
            <div class="flex gap-2">
              <input
                type="url"
                formControlName="reportUrl"
                class="form-input flex-1"
                placeholder="https://infrastructuretransparency.org/resource/..."
                [class.valid]="isFieldValid('independentReviewData.reportUrl')"
                [class.invalid]="resourceForm.get('independentReviewData.reportUrl')?.invalid && resourceForm.get('independentReviewData.reportUrl')?.touched">
              <button
                type="button"
                (click)="importFromUrl()"
                [disabled]="!resourceForm.get('independentReviewData.reportUrl')?.value || importingUrl"
                class="btn-primary px-6"
                [class.opacity-50]="!resourceForm.get('independentReviewData.reportUrl')?.value || importingUrl">
                {{ importingUrl ? 'Importing...' : 'Import' }}
              </button>
            </div>
            <p class="field-hint">We'll automatically extract the report details for you</p>
            
            <!-- Report Period (only show after successful import or if manually filled) -->
            <div *ngIf="resourceForm.get('independentReviewData.reportUrl')?.value" class="mt-4">
              <label class="form-label">Report Period</label>
              <input
                type="text"
                formControlName="reportPeriod"
                class="form-input"
                placeholder="e.g., 2023 Annual Review">
            </div>
          </div>
        </div>

        <!-- Step 3: Preview (only shown when file/link is added) -->
        <div *ngIf="hasFileOrLink()" class="form-section">
          <label class="form-label">Preview</label>
          <div class="preview-card">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <svg class="w-6 h-6 text-gray-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <div>
                  <p class="font-medium">{{ getResourcePreviewName() }}</p>
                  <p class="text-sm text-gray-500">{{ getResourcePreviewType() }}</p>
                </div>
              </div>
              <button
                type="button"
                (click)="clearFileSelection()"
                class="text-gray-400 hover:text-red-500 transition-colors">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Section Navigation -->
        <div class="section-navigation">
          <button
            *ngIf="canNavigate('previous')"
            type="button"
            (click)="navigateToTab('previous')"
            class="btn-nav-previous">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Previous: {{ tabs[getCurrentTabIndex() - 1].label }}
          </button>
          <div class="nav-spacer"></div>
          <button
            *ngIf="canNavigate('next')"
            type="button"
            (click)="navigateToTab('next')"
            class="btn-nav-next">
            Next: {{ tabs[getCurrentTabIndex() + 1].label }}
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Metadata Tab -->
      <div *ngIf="activeTab === 'metadata'" class="tab-panel animate-fadeIn">
        <div class="section-header">
          <h2 class="text-base font-medium text-gray-900">Additional Information</h2>
          <p *ngIf="getTabHint('metadata')" class="text-sm text-gray-600 mt-1">
            {{ getTabHint('metadata') }}
          </p>
        </div>

        <!-- Country & Language -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-section">
            <label class="form-label required">Country/Region</label>
            <select formControlName="country" class="form-select">
              <option value="global">Global</option>
              <option value="gt">Guatemala</option>
              <option value="ug">Uganda</option>
              <option value="th">Thailand</option>
              <option value="uk">United Kingdom</option>
              <option value="ph">Philippines</option>
            </select>
          </div>

          <div class="form-section">
            <label class="form-label required">Primary Language</label>
            <select formControlName="language" class="form-select">
              <option *ngFor="let lang of languages" [value]="lang.value">
                {{ lang.flag }} {{ lang.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Difficulty & Format -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-section">
            <label class="form-label">Difficulty Level</label>
            <div class="difficulty-selector">
              <button
                *ngFor="let level of ['beginner', 'intermediate', 'advanced']"
                type="button"
                (click)="resourceForm.patchValue({difficulty: level})"
                class="difficulty-option"
                [class.selected]="resourceForm.get('difficulty')?.value === level">
                <span class="difficulty-icon">
                  {{ level === 'beginner' ? '🌱' : level === 'intermediate' ? '🌿' : '🌳' }}
                </span>
                <span class="capitalize">{{ level }}</span>
              </button>
            </div>
          </div>

          <div class="form-section">
            <label class="form-label">File Format</label>
            <input
              type="text"
              formControlName="format"
              class="form-input"
              placeholder="e.g., PDF, Excel, Word">
          </div>
        </div>

        <!-- Section Navigation -->
        <div class="section-navigation">
          <button
            *ngIf="canNavigate('previous')"
            type="button"
            (click)="navigateToTab('previous')"
            class="btn-nav-previous">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Previous: {{ tabs[getCurrentTabIndex() - 1].label }}
          </button>
          <div class="nav-spacer"></div>
          <button
            *ngIf="canNavigate('next')"
            type="button"
            (click)="navigateToTab('next')"
            class="btn-nav-next">
            Next: {{ tabs[getCurrentTabIndex() + 1].label }}
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
      </div>
    </form>

    <!-- Action Buttons -->
    <div class="form-actions">
      <div class="action-group">
        <button
          type="button"
          (click)="cancel()"
          class="btn-secondary">
          Cancel
        </button>
        <button
          type="button"
          (click)="togglePreview()"
          class="btn-secondary">
          <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
          </svg>
          Preview
        </button>
      </div>
      
      <div class="action-group">
        <button
          type="button"
          (click)="saveResource()"
          [disabled]="saving"
          class="btn-primary">
          <svg *ngIf="!saving" class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V2" />
          </svg>
          <svg *ngIf="saving" class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          {{ saving ? 'Saving...' : 'Save as Draft' }}
        </button>
        
        <button
          type="button"
          (click)="publishResource()"
          [disabled]="saving || !resourceForm.valid"
          class="btn-publish">
          <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Save & Publish
        </button>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div *ngIf="showPreview" class="preview-modal">
    <div class="preview-content">
      <div class="preview-header">
        <h2 class="text-2xl font-bold">Preview</h2>
        <button
          type="button"
          (click)="togglePreview()"
          class="btn-icon">
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <div class="preview-body">
        <!-- Preview content would go here -->
        <div class="bg-gray-50 rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-2">{{ resourceForm.get('title.en')?.value }}</h3>
          <p class="text-gray-600 mb-4">{{ resourceForm.get('description.en')?.value }}</p>
          
          <div class="flex flex-wrap gap-2 mb-4">
            <span *ngFor="let topic of resourceForm.get('topics')?.value" 
                  class="px-3 py-1 bg-cost-teal/10 text-cost-teal rounded-full text-sm">
              {{ topic }}
            </span>
          </div>
          
          <p class="text-sm text-gray-500">
            Type: {{ resourceForm.get('type')?.value }} | 
            Status: {{ resourceForm.get('status')?.value }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>